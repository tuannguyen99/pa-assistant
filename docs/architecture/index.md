# pa-system Architecture Document

## Table of Contents

- [pa-system Architecture Document](#table-of-contents)
  - [Executive Summary](./executive-summary.md)
  - [Project Initialization](./project-initialization.md)
  - [Technology Stack](./technology-stack.md)
  - [Decision Summary](./decision-summary.md)
  - [Complete Project Structure](./complete-project-structure.md)
  - [Epic to Architecture Mapping](./epic-to-architecture-mapping.md)
  - [High-Level Architecture Diagram](./high-level-architecture-diagram.md)
    - [System Architecture Overview](./high-level-architecture-diagram.md#system-architecture-overview)
    - [Data Flow Architecture](./high-level-architecture-diagram.md#data-flow-architecture)
    - [Multi-Role Access Control Flow](./high-level-architecture-diagram.md#multi-role-access-control-flow)
    - [AI Integration Architecture](./high-level-architecture-diagram.md#ai-integration-architecture)
    - [Security Layers](./high-level-architecture-diagram.md#security-layers)
    - [Review Workflow State Machine](./high-level-architecture-diagram.md#review-workflow-state-machine)
  - [Database Schema Visualization](./database-schema-visualization.md)
    - [Entity Relationship Diagram (ERD)](./database-schema-visualization.md#entity-relationship-diagram-erd)
    - [Key Relationships](./database-schema-visualization.md#key-relationships)
    - [Data Flow: Review Lifecycle](./database-schema-visualization.md#data-flow-review-lifecycle)
    - [Data Relationships & Constraints](./database-schema-visualization.md#data-relationships-constraints)
    - [JSON Field Structures](./database-schema-visualization.md#json-field-structures)
    - [Migration Path: SQLite → PostgreSQL](./database-schema-visualization.md#migration-path-sqlite-postgresql)
  - [Component Architecture Overview](./component-architecture-overview.md)
    - [Component Hierarchy](./component-architecture-overview.md#component-hierarchy)
    - [Component Categories](./component-architecture-overview.md#component-categories)
    - [Component Communication Patterns](./component-architecture-overview.md#component-communication-patterns)
    - [Component Design Principles](./component-architecture-overview.md#component-design-principles)
  - [Frontend Integration with v0.dev Generated Components](./frontend-integration-with-v0dev-generated-components.md)
    - [Integration Architecture](./frontend-integration-with-v0dev-generated-components.md#integration-architecture)
    - [Component Placement Strategy](./frontend-integration-with-v0dev-generated-components.md#component-placement-strategy)
    - [Adapter Pattern Implementation](./frontend-integration-with-v0dev-generated-components.md#adapter-pattern-implementation)
    - [v0 Component Registry](./frontend-integration-with-v0dev-generated-components.md#v0-component-registry)
    - [Integration Rules](./frontend-integration-with-v0dev-generated-components.md#integration-rules)
    - [Data Transformation Patterns](./frontend-integration-with-v0dev-generated-components.md#data-transformation-patterns)
    - [v0.dev Prompt Templates](./frontend-integration-with-v0dev-generated-components.md#v0dev-prompt-templates)
    - [Version Control for v0 Components](./frontend-integration-with-v0dev-generated-components.md#version-control-for-v0-components)
    - [Migration Path](./frontend-integration-with-v0dev-generated-components.md#migration-path)
    - [Component Testing Strategy](./frontend-integration-with-v0dev-generated-components.md#component-testing-strategy)
    - [Component Performance Optimization](./frontend-integration-with-v0dev-generated-components.md#component-performance-optimization)
    - [Component Accessibility (WCAG 2.1 AA)](./frontend-integration-with-v0dev-generated-components.md#component-accessibility-wcag-21-aa)
  - [Frontend Architecture](./frontend-architecture.md)
    - [Architecture Overview](./frontend-architecture.md#architecture-overview)
    - [Rendering Strategy](./frontend-architecture.md#rendering-strategy)
    - [State Management Strategy](./frontend-architecture.md#state-management-strategy)
    - [Data Fetching Patterns](./frontend-architecture.md#data-fetching-patterns)
    - [Styling Architecture](./frontend-architecture.md#styling-architecture)
    - [Form Handling Architecture](./frontend-architecture.md#form-handling-architecture)
    - [Error Handling & Loading States](./frontend-architecture.md#error-handling-loading-states)
    - [Frontend Performance Optimizations](./frontend-architecture.md#frontend-performance-optimizations)
  - [Backend Architecture](./backend-architecture.md)
    - [Architecture Overview](./backend-architecture.md#architecture-overview)
    - [API Route Structure](./backend-architecture.md#api-route-structure)
    - [Service Layer Pattern](./backend-architecture.md#service-layer-pattern)
    - [Validation Layer (Zod Schemas)](./backend-architecture.md#validation-layer-zod-schemas)
    - [Transaction Patterns](./backend-architecture.md#transaction-patterns)
    - [Error Handling Strategy](./backend-architecture.md#error-handling-strategy)
    - [Middleware Pattern](./backend-architecture.md#middleware-pattern)
    - [Logging & Monitoring](./backend-architecture.md#logging-monitoring)
    - [Caching Strategy](./backend-architecture.md#caching-strategy)
  - [Core Workflows](./core-workflows.md)
    - [Workflow 1: Target Setting Process](./core-workflows.md#workflow-1-target-setting-process)
    - [Workflow 2: Self-Evaluation Submission](./core-workflows.md#workflow-2-self-evaluation-submission)
    - [Workflow 3: Manager Evaluation & Scoring](./core-workflows.md#workflow-3-manager-evaluation-scoring)
    - [Workflow 4: Role Switching & Delegation](./core-workflows.md#workflow-4-role-switching-delegation)
    - [Workflow 5: Review Archival & Historical Access](./core-workflows.md#workflow-5-review-archival-historical-access)
  - [Architectural Patterns](./architectural-patterns.md)
    - [1. Layered Architecture Pattern](./architectural-patterns.md#1-layered-architecture-pattern)
    - [2. Repository Pattern (via Prisma)](./architectural-patterns.md#2-repository-pattern-via-prisma)
    - [3. Strategy Pattern (Authentication Providers)](./architectural-patterns.md#3-strategy-pattern-authentication-providers)
    - [4. Facade Pattern (Service Layer)](./architectural-patterns.md#4-facade-pattern-service-layer)
    - [5. Factory Pattern (API Response Creation)](./architectural-patterns.md#5-factory-pattern-api-response-creation)
    - [6. Middleware Pattern (RBAC Enforcement)](./architectural-patterns.md#6-middleware-pattern-rbac-enforcement)
    - [7. Observer Pattern (Audit Logging)](./architectural-patterns.md#7-observer-pattern-audit-logging)
    - [8. Adapter Pattern (AI Service)](./architectural-patterns.md#8-adapter-pattern-ai-service)
    - [9. Template Method Pattern (Form Validation)](./architectural-patterns.md#9-template-method-pattern-form-validation)
    - [10. Singleton Pattern (Database Connection)](./architectural-patterns.md#10-singleton-pattern-database-connection)
    - [11. Decorator Pattern (Logging & Timing)](./architectural-patterns.md#11-decorator-pattern-logging-timing)
    - [12. CQRS Light (Command Query Separation)](./architectural-patterns.md#12-cqrs-light-command-query-separation)
    - [13. State Machine Pattern (Review Workflow)](./architectural-patterns.md#13-state-machine-pattern-review-workflow)
    - [14. Composition Over Inheritance](./architectural-patterns.md#14-composition-over-inheritance)
    - [15. Dependency Injection (Implicit via Imports)](./architectural-patterns.md#15-dependency-injection-implicit-via-imports)
  - [Pattern Selection Guidelines](./pattern-selection-guidelines.md)
  - [Anti-Patterns to Avoid](./anti-patterns-to-avoid.md)
  - [Authentication Architecture](./authentication-architecture.md)
    - [Pluggable Provider Pattern](./authentication-architecture.md#pluggable-provider-pattern)
    - [MVP Implementation (Username/Password)](./authentication-architecture.md#mvp-implementation-usernamepassword)
    - [Future LDAP Migration](./authentication-architecture.md#future-ldap-migration)
    - [Auth Service Abstraction](./authentication-architecture.md#auth-service-abstraction)
    - [User Database Schema](./authentication-architecture.md#user-database-schema)
  - [AI Integration Architecture](./ai-integration-architecture.md)
    - [Dual-Mode Strategy](./ai-integration-architecture.md#dual-mode-strategy)
    - [Implementation](./ai-integration-architecture.md#implementation)
    - [API Routes](./ai-integration-architecture.md#api-routes)
    - [AI Config Database Schema](./ai-integration-architecture.md#ai-config-database-schema)
  - [Implementation Patterns & Consistency Rules](./implementation-patterns-consistency-rules.md)
    - [Naming Conventions](./implementation-patterns-consistency-rules.md#naming-conventions)
    - [Error Handling](./implementation-patterns-consistency-rules.md#error-handling)
    - [Logging Strategy](./implementation-patterns-consistency-rules.md#logging-strategy)
    - [Date/Time Handling](./implementation-patterns-consistency-rules.md#datetime-handling)
    - [Validation with Zod](./implementation-patterns-consistency-rules.md#validation-with-zod)
  - [Data Architecture](./data-architecture.md)
    - [Complete Prisma Schema](./data-architecture.md#complete-prisma-schema)
  - [Security Architecture](./security-architecture.md)
    - [Authentication & Authorization](./security-architecture.md#authentication-authorization)
    - [RBAC Implementation](./security-architecture.md#rbac-implementation)
    - [Data Protection](./security-architecture.md#data-protection)
  - [Performance Considerations](./performance-considerations.md)
    - [NFR001 Compliance](./performance-considerations.md#nfr001-compliance)
  - [Deployment Architecture](./deployment-architecture.md)
    - [MVP Deployment (Pilot: 10 users)](./deployment-architecture.md#mvp-deployment-pilot-10-users)
    - [Production Deployment (200+ users)](./deployment-architecture.md#production-deployment-200-users)
    - [Environment Configuration](./deployment-architecture.md#environment-configuration)
  - [Analytics & Insights Architecture (Epic 3)](./analytics-insights-architecture-epic-3.md)
    - [Overview](./analytics-insights-architecture-epic-3.md#overview)
    - [Analytics Data Flow](./analytics-insights-architecture-epic-3.md#analytics-data-flow)
    - [Database Schema Extensions for Analytics](./analytics-insights-architecture-epic-3.md#database-schema-extensions-for-analytics)
    - [Analytics Service Layer](./analytics-insights-architecture-epic-3.md#analytics-service-layer)
    - [API Routes for Analytics](./analytics-insights-architecture-epic-3.md#api-routes-for-analytics)
    - [Visualization Components (Recharts)](./analytics-insights-architecture-epic-3.md#visualization-components-recharts)
    - [Performance Optimization for Analytics](./analytics-insights-architecture-epic-3.md#performance-optimization-for-analytics)
    - [Analytics Dashboard Pages](./analytics-insights-architecture-epic-3.md#analytics-dashboard-pages)
    - [Transfer Tracking Implementation (Story 3.5)](./analytics-insights-architecture-epic-3.md#transfer-tracking-implementation-story-35)
  - [Testing Strategy](./testing-strategy.md)
    - [Unit Tests (Vitest)](./testing-strategy.md#unit-tests-vitest)
    - [Integration Tests](./testing-strategy.md#integration-tests)
    - [E2E Tests (Playwright)](./testing-strategy.md#e2e-tests-playwright)
  - [Architecture Decision Records (ADRs)](./architecture-decision-records-adrs.md)
    - [ADR-001: Choose Next.js 14+ App Router over separate frontend/backend](./architecture-decision-records-adrs.md#adr-001-choose-nextjs-14-app-router-over-separate-frontendbackend)
    - [ADR-002: SQLite for MVP  PostgreSQL for Production](./architecture-decision-records-adrs.md#adr-002-sqlite-for-mvp-postgresql-for-production)
    - [ADR-003: Dual-Mode AI (Web + Local Ollama)](./architecture-decision-records-adrs.md#adr-003-dual-mode-ai-web-local-ollama)
    - [ADR-004: Multi-Role Support with Audit Trail](./architecture-decision-records-adrs.md#adr-004-multi-role-support-with-audit-trail)
  - [Development Workflow](./development-workflow.md)
    - [Getting Started](./development-workflow.md#getting-started)
    - [Development Commands](./development-workflow.md#development-commands)
    - [Environment Configuration](./development-workflow.md#environment-configuration)
    - [Testing Strategy](./development-workflow.md#testing-strategy)
    - [Test Organization](./development-workflow.md#test-organization)
    - [Test Examples](./development-workflow.md#test-examples)
  - [Coding Standards](./coding-standards.md)
    - [General Principles](./coding-standards.md#general-principles)
    - [TypeScript Standards](./coding-standards.md#typescript-standards)
    - [Naming Conventions](./coding-standards.md#naming-conventions)
    - [Code Organization](./coding-standards.md#code-organization)
    - [React Best Practices](./coding-standards.md#react-best-practices)
    - [Error Handling](./coding-standards.md#error-handling)
    - [Database Best Practices](./coding-standards.md#database-best-practices)
    - [Security Standards](./coding-standards.md#security-standards)
    - [Testing Standards](./coding-standards.md#testing-standards)
    - [Performance Standards](./coding-standards.md#performance-standards)
    - [Documentation Standards](./coding-standards.md#documentation-standards)
    - [Code Review Checklist](./coding-standards.md#code-review-checklist)
  - [Error Handling Strategy](./error-handling-strategy.md)
    - [Error Categories](./error-handling-strategy.md#error-categories)
    - [Error Response Format](./error-handling-strategy.md#error-response-format)
    - [Error Monitoring Best Practices](./error-handling-strategy.md#error-monitoring-best-practices)
  - [Background Job Processing Architecture](./background-job-processing-architecture.md)
    - [Overview](./background-job-processing-architecture.md#overview)
    - [Background Job Use Cases](./background-job-processing-architecture.md#background-job-use-cases)
    - [Architecture Diagram](./background-job-processing-architecture.md#architecture-diagram)
    - [Implementation Strategy](./background-job-processing-architecture.md#implementation-strategy)
    - [Performance Thresholds](./background-job-processing-architecture.md#performance-thresholds)
  - [Monitoring and Observability Architecture](./monitoring-and-observability-architecture.md)
    - [Overview](./monitoring-and-observability-architecture.md#overview)
    - [Observability Stack](./monitoring-and-observability-architecture.md#observability-stack)
    - [Application Logging](./monitoring-and-observability-architecture.md#application-logging)
    - [Health Check Endpoint](./monitoring-and-observability-architecture.md#health-check-endpoint)
    - [Metrics Collection](./monitoring-and-observability-architecture.md#metrics-collection)
    - [Alert Thresholds](./monitoring-and-observability-architecture.md#alert-thresholds)
    - [Monitoring Dashboard (Grafana)](./monitoring-and-observability-architecture.md#monitoring-dashboard-grafana)
    - [Log Aggregation Setup](./monitoring-and-observability-architecture.md#log-aggregation-setup)
  - [Security and Performance](./security-and-performance.md)
    - [Security Architecture](./security-and-performance.md#security-architecture)
    - [Performance Optimization](./security-and-performance.md#performance-optimization)
  - [Deployment Architecture](./deployment-architecture.md)
    - [Overview](./deployment-architecture.md#overview)
    - [Production Deployment Configuration](./deployment-architecture.md#production-deployment-configuration)
      - [Production Architecture Diagram](./deployment-architecture.md#production-architecture-diagram)
      - [Docker Compose Production Configuration](./deployment-architecture.md#docker-compose-production-configuration)
      - [Production Dockerfile](./deployment-architecture.md#production-dockerfile)
      - [Nginx Production Configuration](./deployment-architecture.md#nginx-production-configuration)
      - [Security Hardening Checklist](./deployment-architecture.md#security-hardening-checklist)
      - [Deployment Commands](./deployment-architecture.md#deployment-commands)
    - [Deployment Environments](./deployment-architecture.md#deployment-environments)
    - [MVP Deployment (Single Server)](./deployment-architecture.md#mvp-deployment-single-server)
    - [Production Deployment (Scaled)](./deployment-architecture.md#production-deployment-scaled)
    - [Container Deployment (Docker)](./deployment-architecture.md#container-deployment-docker)
    - [Kubernetes Deployment (Advanced)](./deployment-architecture.md#kubernetes-deployment-advanced)
    - [Nginx Configuration](./deployment-architecture.md#nginx-configuration)
    - [Database Backup Strategy](./deployment-architecture.md#database-backup-strategy)
    - [Monitoring Setup](./deployment-architecture.md#monitoring-setup)
    - [CI/CD Pipeline](./deployment-architecture.md#cicd-pipeline)
    - [Environment Variables](./deployment-architecture.md#environment-variables)
    - [Deployment Checklist](./deployment-architecture.md#deployment-checklist)
    - [Rollback Strategy](./deployment-architecture.md#rollback-strategy)
    - [Disaster Recovery](./deployment-architecture.md#disaster-recovery)
  - [Next Steps](./next-steps.md)
  - [Document Change Log](./document-change-log.md)
    - [November 7, 2025 - Critical Risks Mitigation](./document-change-log.md#november-7-2025-critical-risks-mitigation)
      - [1. ✅ FIXED: v0.dev UI Integration (Risk 1 - HIGH PRIORITY)](./document-change-log.md#1-fixed-v0dev-ui-integration-risk-1-high-priority)
      - [2. ✅ FIXED: Version Verification Dates (Risk 2 - MEDIUM PRIORITY)](./document-change-log.md#2-fixed-version-verification-dates-risk-2-medium-priority)
      - [3. ✅ FIXED: Production Deployment Configuration (Risk 3 - MEDIUM PRIORITY)](./document-change-log.md#3-fixed-production-deployment-configuration-risk-3-medium-priority)
      - [4. ✅ FIXED: Background Job Processing (Risk 4 - LOW-MEDIUM PRIORITY)](./document-change-log.md#4-fixed-background-job-processing-risk-4-low-medium-priority)
      - [5. ✅ FIXED: Monitoring and Observability (Risk 5 - LOW PRIORITY)](./document-change-log.md#5-fixed-monitoring-and-observability-risk-5-low-priority)
